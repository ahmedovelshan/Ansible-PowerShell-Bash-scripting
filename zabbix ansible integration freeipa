Install zabbix on control node
ansible-galaxy collection install community.zabbix
sudo pip3 zabbix-api
sudo pip3 install zabbix-api
sudo pip3 install zabbix_api
sudo pip3 install pyzabbix



cat > zabbix.yml 


---
- name: Installation and configuration zabbix agent
  hosts: linux
  roles:
    - role: community.zabbix.zabbix_agent
      zabbix_agent_server: 10.220.55.5
      zabbix_agent_serveractive:  10.220.55.5
      zabbix_agent_host_state: present
      zabbix_agent_dont_detect_ip: True
  tasks:
    - name: Open firewall port
      firewalld:
        zone: public
        service: zabbix-agent
        permanent: yes
        state: enabled
        immediate: yes
    - name: Restart zabbix agent service
      service:
        name: zabbix-agent.service
        state: restarted



- name: Create linux hosts in zabbix server
  hosts: localhost
  vars_files:
    - /home/ansible/hosts.yml
    - /home/ansible/secret.yml
  tasks:
  - name: Create a new host or update an existing host's info
    local_action:
      module: community.zabbix.zabbix_host
      validate_certs: no
      server_url: https://zabbix.pasha-technology.net/
      login_user: "{{ username }}"
      login_password: "{{ password }}"
      host_name: "{{ item.hostname }}"
      visible_name: "{{ item.visible_name }}"
      description: "{{ item.description }}"
      host_groups:
        - "{{ item.group }}"
      link_templates:
        - "{{ item.template }}"
      status: enabled
      state: present
      interfaces:
        - type: 1
          main: 1
          useip: 1
          ip: "{{ item.ip }}"
          port: 10050
          dns: ""
    loop: "{{ hosts }}"



...



__________________________
cat hosts.yml

hosts:
  - hostname: ansible1
    visible_name: ansible1
    description: Test server
    group: Linux servers
    template: Linux by Zabbix agent
    ip: 10.220.56.51
  - hostname: ansible2
    visible_name: ansible2
    description:  Test server 2
    group:  Linux servers
    template: Linux by Zabbix agent
    ip: 10.220.56.52


_____________________________________________________

cat > freeipa.yml


---
- name: configuration freeipa client
  hosts: ansible1
  tasks:
    - name: install ipa-client package
      package:
        name: ipa-client
        state: present
    - name: add line to hosts file
      lineinfile:
        path: /etc/hosts
        line: 10.220.55.151 pt-bmdc-ipa1.id.pasha-technology.net
    - name: join vm to freeipa
      shell: sudo ipa-client-install --hostname=`hostname -f` --mkhomedir --server=pt-bmdc-ipa1.id.pasha-technology.net --domain id.pasha-technology.net --realm ID.PASHA-TECHNOLOGY.NET -p admin -w ******** -U







